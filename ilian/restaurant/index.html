<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kinder-Restaurant ‚Äì Kellner:in spielen (Fotos)</title>
  <style>
    :root{
      --pink:#ff4f9a; --pink-dark:#c71c6f; --violet:#7b1fa2; --mint:#e0fff4; --card:#fff7fb; --ink:#333;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Comic Sans MS","Nunito",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#fff0f6,#fff);color:var(--ink);display:flex;flex-direction:column;align-items:center;padding:18px}
    header{width:min(1280px,94vw);display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:16px}
    h1{margin:0;font-size:clamp(1.2rem,2.8vw + .8rem,2.2rem);color:var(--pink-dark);text-shadow:0 2px 0 rgba(0,0,0,.06)}
    #totals{background:var(--violet);color:#fff;border-radius:16px;padding:10px 16px;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,.12);display:flex;gap:14px;align-items:center;white-space:nowrap}
    #totals span{min-width:90px;text-align:right;display:inline-block}
    .actions{width:min(1280px,94vw);display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 16px}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.12);transition:transform .05s ease,filter .15s ease}
    .btn:hover{filter:brightness(1.03)} .btn:active{transform:translateY(1px)}
    .primary{background:#4CAF50;color:#fff} .danger{background:#f44336;color:#fff} .ghost{background:#fff;border:2px dashed var(--pink);color:var(--pink-dark)}
    .tip-group{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .tip-btn{background:#ffe5f1;color:var(--pink-dark)} .tip-btn.active{background:var(--pink);color:#fff}
    #menu{width:min(1280px,94vw);display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px}
    .item{background:var(--card);border:2px solid #ffd0e8;border-radius:16px;padding:12px;text-align:center;cursor:pointer;position:relative;display:flex;flex-direction:column;justify-content:space-between;min-height:220px;transition:transform .12s ease,box-shadow .12s ease}
    .item:hover{transform:translateY(-3px);box-shadow:0 10px 18px rgba(0,0,0,.12)}
    .photo{width:100%;height:120px;object-fit:cover;border-radius:12px;border:2px solid #ffc1df;background:#fff}
    .emoji-fallback{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:48px;opacity:.3}
    .title{color:var(--pink-dark);margin:8px 0 2px;font-weight:800}
    .price{color:#a3155b;font-weight:800}
    .count-badge{position:absolute;top:8px;left:8px;background:var(--pink);color:#fff;font-weight:900;padding:4px 8px;border-radius:999px;font-size:.85rem;display:none}
    .footer{width:min(1280px,94vw);margin-top:16px;background:var(--mint);border:2px solid #b6f2de;border-radius:16px;padding:12px 14px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .split{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .kv{font-weight:800} .kv span{min-width:90px;display:inline-block;text-align:right}
    input[type="number"]{padding:10px 12px;border-radius:10px;border:2px solid #ffd0e8;max-width:120px}
    .mini-cart{flex:1 1 320px;background:#fff;border:2px dashed #b6f2de;border-radius:12px;padding:10px;max-height:160px;overflow:auto}
    .mini-cart h3{margin:0 0 8px 0;color:#0e7a58;font-size:1rem}
    .mini-cart ul{margin:0;padding-left:18px}
    .mini-cart li{margin:2px 0}
    @media (max-width:600px){#menu{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.item{min-height:200px}.photo{height:100px}}
  </style>
</head>
<body>
  <header>
    <h1>üçΩÔ∏è Kinder-Restaurant ‚Äì Kellner:in spielen</h1>
    <div id="totals">Zwischensumme: <span id="subtotal">‚Ç¨0,00</span> Trinkgeld: <span id="tip">‚Ç¨0,00</span> Gesamt: <span id="grand">‚Ç¨0,00</span></div>
  </header>

  <div class="actions">
    <div class="tip-group">
      <span style="font-weight:800;color:#7b1fa2">Trinkgeld:</span>
      <button class="btn tip-btn" data-tip="0">0%</button>
      <button class="btn tip-btn" data-tip="5">5%</button>
      <button class="btn tip-btn" data-tip="10">10%</button>
      <button class="btn tip-btn" data-tip="15">15%</button>
      <label class="btn ghost" style="display:flex;gap:8px;align-items:center">Eigenes % <input id="customTip" type="number" min="0" max="100" step="1" value="" style="width:70px"></label>
    </div>
    <button id="payBtn" class="btn primary">Bezahlen</button>
    <button id="resetBtn" class="btn danger">Zur√ºcksetzen</button>
  </div>

  <section id="menu"></section>

  <div class="footer">
    <div class="split">
      <div class="kv">Artikel: <span id="count">0</span></div>
      <div class="kv">Zwischensumme: <span id="subtotal2">‚Ç¨0,00</span></div>
      <div class="kv">Trinkgeld: <span id="tip2">‚Ç¨0,00</span></div>
      <div class="kv">Gesamt: <span id="grand2">‚Ç¨0,00</span></div>
    </div>
    <div class="mini-cart">
      <h3>Bestellung</h3>
      <ul id="cartList"></ul>
    </div>
  </div>

  <script>
    // === KONFIGURATION ===
    // Pfad zur Bankseite (ggf. anpassen)
    const BANK_PAGE_URL = '../bank/index.html';

    const CURRENCY = new Intl.NumberFormat('de-AT', {style: 'currency', currency: 'EUR'});

    // Men√ºeintr√§ge (mit Bildern)
    const ITEMS = [
      { name:'Burger',        price:7.50,  emoji:'üçî', img:'https://source.unsplash.com/featured/?burger' },
      { name:'Pizza',         price:8.00,  emoji:'üçï', img:'https://source.unsplash.com/featured/?pizza' },
      { name:'Palatschinken', price:5.50,  emoji:'ü•û', img:'https://source.unsplash.com/featured/?pancakes' },
      { name:'Orangensaft',   price:2.80,  emoji:'üßÉ', img:'https://source.unsplash.com/featured/?orange-juice' },
      { name:'Obst',          price:3.20,  emoji:'üçé', img:'https://source.unsplash.com/featured/?fruit-bowl' },
      { name:'Caf√© Latte',    price:3.60,  emoji:'‚òï', img:'https://source.unsplash.com/featured/?latte' },
      { name:'Cola',          price:2.90,  emoji:'ü•§', img:'https://source.unsplash.com/featured/?cola' },
      { name:'Kaffee',        price:2.50,  emoji:'‚òï', img:'https://source.unsplash.com/featured/?coffee' },
      { name:'Salat',         price:4.90,  emoji:'ü•ó', img:'https://source.unsplash.com/featured/?salad' },
      { name:'Schnitzel',     price:9.50,  emoji:'ü•©', img:'https://source.unsplash.com/featured/?schnitzel' },
      { name:'Pommes',        price:3.40,  emoji:'üçü', img:'https://source.unsplash.com/featured/?fries' },
      { name:'W√ºrstl',        price:4.10,  emoji:'üå≠', img:'https://source.unsplash.com/featured/?sausage' },
      { name:'Himbeersaft',   price:2.70,  emoji:'üßÉ', img:'https://source.unsplash.com/featured/?raspberry-juice' },
      { name:'Wasser',        price:1.50,  emoji:'üíß', img:'https://source.unsplash.com/featured/?water-bottle' },
      { name:'Sprudelwasser', price:1.80,  emoji:'üí¶', img:'https://source.unsplash.com/featured/?sparkling-water' },
      { name:'Kuchen',        price:3.90,  emoji:'üç∞', img:'https://source.unsplash.com/featured/?cake' }
    ];

    // === STATE ===
    const state = { items: ITEMS.map(it => ({...it, qty:0})), tipRate: 0 };

    // === DOM REF ===
    const menu = document.getElementById('menu');
    const subtotalEl = document.getElementById('subtotal');
    const tipEl = document.getElementById('tip');
    const grandEl = document.getElementById('grand');
    const subtotalEl2 = document.getElementById('subtotal2');
    const tipEl2 = document.getElementById('tip2');
    const grandEl2 = document.getElementById('grand2');
    const countEl = document.getElementById('count');
    const cartList = document.getElementById('cartList');
    const payBtn = document.getElementById('payBtn');
    const resetBtn = document.getElementById('resetBtn');
    const tipButtons = [...document.querySelectorAll('.tip-btn')];
    const customTip = document.getElementById('customTip');

    // === RENDER MENU ===
    function renderMenu(){
      menu.innerHTML = '';
      state.items.forEach((it, idx) => {
        const card = document.createElement('button');
        card.className = 'item';
        card.type = 'button';
        card.setAttribute('aria-label', `${it.name} hinzuf√ºgen`);

        const badge = document.createElement('span');
        badge.className = 'count-badge';
        badge.textContent = '√ó' + it.qty;
        card.appendChild(badge);

        const imgWrap = document.createElement('div');
        imgWrap.style.position = 'relative';
        imgWrap.style.minHeight = '120px';
        const img = document.createElement('img');
        img.className = 'photo';
        img.alt = it.name;
        img.loading = 'lazy';
        img.src = it.img;
        const fallback = document.createElement('div');
        fallback.className = 'emoji-fallback';
        fallback.textContent = it.emoji;
        img.onerror = () => { fallback.style.display = 'flex'; img.style.visibility = 'hidden'; };
        img.onload = () => { fallback.style.display = 'none'; img.style.visibility = 'visible'; };
        imgWrap.appendChild(img);
        imgWrap.appendChild(fallback);
        card.appendChild(imgWrap);

        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = it.name;
        card.appendChild(title);

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = 'Preis: ' + CURRENCY.format(it.price);
        card.appendChild(price);

        card.addEventListener('click', () => add(idx));
        menu.appendChild(card);
      });
    }

    // === CART LOGIC ===
    function add(i){ state.items[i].qty++; update(); }
    function clearAll(){ state.items.forEach(it=>it.qty=0); update(); }

    function calcSubtotal(){ return state.items.reduce((s,it)=> s + it.qty * it.price, 0); }
    function calcTip(sub){ return +(sub * state.tipRate).toFixed(2); }

    function update(){
      // badges
      [...menu.querySelectorAll('.item')].forEach((node, idx) => {
        const qty = state.items[idx].qty;
        const badge = node.querySelector('.count-badge');
        if(qty>0){ badge.style.display='inline-block'; badge.textContent='√ó'+qty; }
        else { badge.style.display='none'; }
      });

      const sub = +(calcSubtotal().toFixed(2));
      const tip = calcTip(sub);
      const total = +(sub + tip).toFixed(2);
      const count = state.items.reduce((s,it)=>s+it.qty,0);

      subtotalEl.textContent = CURRENCY.format(sub);
      tipEl.textContent = CURRENCY.format(tip);
      grandEl.textContent = CURRENCY.format(total);
      subtotalEl2.textContent = CURRENCY.format(sub);
      tipEl2.textContent = CURRENCY.format(tip);
      grandEl2.textContent = CURRENCY.format(total);
      countEl.textContent = count;

      // mini cart
      cartList.innerHTML = '';
      state.items.filter(it=>it.qty>0).forEach(it=>{
        const li = document.createElement('li');
        li.textContent = `${it.qty}√ó ${it.name} = ${CURRENCY.format(it.qty*it.price)}`;
        cartList.appendChild(li);
      });

      // Store f√ºr Sitzungs-Fortsetzung
      sessionStorage.setItem('restaurant-cart', JSON.stringify({items: state.items, tipRate: state.tipRate}));
    }

    function setTip(rate){
      state.tipRate = rate;
      tipButtons.forEach(btn => btn.classList.toggle('active', +btn.dataset.tip/100 === rate));
      customTip.value = '';
      update();
    }

    // === PAY ‚Üí Einzahlung in die Bank (localStorage) + Weiterleitung ===
    function pay(){
      const sub = +(calcSubtotal().toFixed(2));
      if(sub <= 0) { alert('Bitte zuerst etwas ausw√§hlen.'); return; }
      const total = +(sub + calcTip(sub)).toFixed(2);

      // NEU: Direktes Einzahlen in das Bankkonto (gleiche Keys wie Bank-App)
      const BAL_KEY = 'acmeBankBalance';
      const TX_KEY  = 'acmeBankTransactions';

      const savedBalance = parseFloat(localStorage.getItem(BAL_KEY)) || 0;
      const newBalance   = +(savedBalance + total).toFixed(2);
      localStorage.setItem(BAL_KEY, newBalance);

      // Transaktionsverlauf aktualisieren
      let tx = [];
      try { tx = JSON.parse(localStorage.getItem(TX_KEY)) || []; } catch(e){ tx = []; }
      tx.push({ type:'deposit', amount: total, date: new Date().toLocaleString('de-DE') });
      localStorage.setItem(TX_KEY, JSON.stringify(tx));

      // Optional: Warenkorb leeren (damit zur√ºck im Restaurant alles neu ist)
      clearAll();

      // Weiter zur Bankseite (zeigt den neuen Kontostand)
      window.location.href = BANK_PAGE_URL;
    }

    // === INIT ===
    function restore(){
      try{
        const saved = JSON.parse(sessionStorage.getItem('restaurant-cart'));
        if(saved){
          state.items = saved.items || state.items;
          state.tipRate = saved.tipRate ?? 0;
        }
      }catch(e){}
    }

    renderMenu();
    restore();
    update();

    // UI wiring
    tipButtons.forEach(btn=> btn.addEventListener('click', ()=> setTip(+btn.dataset.tip/100)));
    customTip.addEventListener('input', (e)=>{
      const v = Math.max(0, Math.min(100, +e.target.value||0));
      state.tipRate = v/100; tipButtons.forEach(b=>b.classList.remove('active')); update();
    });
    payBtn.addEventListener('click', pay);
    resetBtn.addEventListener('click', ()=>{ if(confirm('Alles zur√ºcksetzen?')) clearAll(); });
  </script>
</body>
</html>
